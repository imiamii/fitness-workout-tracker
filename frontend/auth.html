<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FitTrack | Auth</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand"><span class="dot"></span>FitTrack</div>
      <div class="nav">
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="workout_creator.html">New Workout</a>
      </div>
    </div>

    <div class="grid">
      <div class="card" style="grid-column: span 5;">
        <h2 id="title">Login</h2>
        <p class="muted" id="subtitle">Sign in to create and manage workouts.</p>

        <div id="regFields" style="display:none;">
          <label class="tiny">Username</label>
          <input class="input" id="username" type="text" placeholder="john_doe" />
          <div style="height: 10px;"></div>
        </div>

        <label class="tiny">Email</label>
        <input class="input" id="email" type="email" placeholder="john@test.com" />
        <div style="height: 10px;"></div>

        <label class="tiny">Password</label>
        <input class="input" id="password" type="password" placeholder="••••••" />

        <div class="row" style="margin-top: 14px;">
          <button class="btn" id="submitBtn" onclick="handleSubmit()">Sign in</button>
          <button class="btn secondary" onclick="toggleAuth()" id="toggleBtn">Register</button>
        </div>

        <div class="msg" id="msg"></div>
      </div>

      <div class="card" style="grid-column: span 7;">
        <h3>Heads up</h3>
        <p class="muted">
        <p>
          Log in to access your workouts, track progress, and stay consistent with your training.
        </p>
        <div class="divider"></div>
        <div class="pill">• Your workouts are saved to your account</div>
        <div style="height: 8px;"></div>
        <div class="pill">• Access your data from any device</div>
        <div style="height: 8px;"></div>
        <div class="pill">• Simple, distraction-free tracking</div>

      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    let isLogin = true;

    function toggleAuth() {
      isLogin = !isLogin;
      document.getElementById('title').textContent = isLogin ? 'Login' : 'Register';
      document.getElementById('subtitle').textContent = isLogin
        ? 'Sign in to create and manage workouts.'
        : 'Create an account to start logging workouts.';
      document.getElementById('regFields').style.display = isLogin ? 'none' : 'block';
      document.getElementById('submitBtn').textContent = isLogin ? 'Sign in' : 'Create account';
      document.getElementById('toggleBtn').textContent = isLogin ? 'Register' : 'Back to login';
      document.getElementById('msg').textContent = '';
      document.getElementById('msg').className = 'msg';
    }

    async function handleSubmit() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const username = document.getElementById('username')?.value?.trim();

      const msg = document.getElementById('msg');
      msg.className = 'msg';
      msg.textContent = 'Working...';

      try {
        if (isLogin) {
          const data = await api('/auth/login', {
            method: 'POST',
            body: JSON.stringify({ email, password })
          });
          localStorage.setItem('token', data.access_token);
          localStorage.setItem('user_id', data.user_id);
          msg.className = 'msg good';
          msg.textContent = 'Logged in ✅ Redirecting...';
          setTimeout(() => window.location.href = 'dashboard.html', 600);
        } else {
          await api('/auth/register', {
            method: 'POST',
            body: JSON.stringify({ username, email, password })
          });
          msg.className = 'msg good';
          msg.textContent = 'Account created ✅ Now log in.';
          // Switch UI back to login
          isLogin = false;
          toggleAuth();
        }
      } catch (e) {
        msg.className = 'msg bad';
        msg.textContent = e.message;
      }
    }

    // If already logged in, bounce to dashboard.
    if (getToken() && getUserId()) {
      window.location.href = 'dashboard.html';
    }
  </script>
</body>
</html>
